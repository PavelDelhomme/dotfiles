# ~/dotfiles/bash/bashrc_custom - Configuration Bash
# =============================================================================
# Configuration Bash pour dotfiles
# Compatible avec la structure ZSH mais adaptÃ© pour Bash
# =============================================================================

# Restaurer le PATH original si nÃ©cessaire
if [ -n "$PATH_ORIGINAL" ]; then
	export PATH=$PATH_ORIGINAL
fi

DOTFILES_PATH="$HOME/dotfiles/"
DOTFILES_BASH_PATH="$DOTFILES_PATH/bash/"
DOTFILES_ZSH_PATH="$DOTFILES_PATH/zsh/"  # Pour partager env.sh et aliases.zsh
ENV_FILE="$DOTFILES_ZSH_PATH/env.sh"
ALIASES_FILES="$DOTFILES_ZSH_PATH/aliases.zsh"
FUNCTIONS_DIR="$DOTFILES_BASH_PATH/functions/"

# Couleurs pour messages
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# =============================================================================
# Ã‰TAPE 1 : CHARGEMENT DU GESTIONNAIRE DE MODULES (MODULEMAN) EN PREMIER
# =============================================================================
# Chercher le fichier de configuration dans plusieurs emplacements
MODULEMAN_CONFIG_FILE="$HOME/dotfiles/.config/moduleman/modules.conf"
if [ ! -f "$MODULEMAN_CONFIG_FILE" ]; then
    MODULEMAN_CONFIG_FILE="$HOME/.config/moduleman/modules.conf"
fi
if [ -f "$MODULEMAN_CONFIG_FILE" ]; then
    source "$MODULEMAN_CONFIG_FILE" 2>/dev/null || true
fi

# Charger moduleman pour gÃ©rer les modules
[ -f "$DOTFILES_BASH_PATH/functions/moduleman.sh" ] && source "$DOTFILES_BASH_PATH/functions/moduleman.sh" 2>/dev/null || true

# =============================================================================
# Ã‰TAPE 2 : CHARGEMENT DES GESTIONNAIRES (*MAN) SELON LA CONFIGURATION
# =============================================================================
# Fonction pour charger un manager si activÃ© (version Bash)
load_manager() {
    local manager_name="$1"
    local manager_file="$2"
    local display_name="$3"
    local var_name="MODULE_${manager_name}"
    local module_status="${!var_name:-enabled}"
    
    if [ "$module_status" = "enabled" ]; then
        if [ -f "$manager_file" ]; then
            source "$manager_file" >/dev/null 2>&1 || true
            # Messages dÃ©sactivÃ©s pour Ã©viter le bruit
        fi
    fi
}

# Charger les managers (mÃªme ordre que ZSH)
load_manager "pathman" "$DOTFILES_BASH_PATH/functions/pathman.sh" "PATHMAN"
load_manager "netman" "$DOTFILES_BASH_PATH/functions/netman.sh" "NETMAN"
load_manager "aliaman" "$DOTFILES_BASH_PATH/functions/aliaman.sh" "ALIAMAN"
load_manager "miscman" "$DOTFILES_BASH_PATH/functions/miscman.sh" "MISCMAN"
load_manager "searchman" "$DOTFILES_BASH_PATH/functions/searchman.sh" "SEARCHMAN"
load_manager "cyberman" "$DOTFILES_BASH_PATH/functions/cyberman.sh" "CYBERMAN"
load_manager "devman" "$DOTFILES_BASH_PATH/functions/devman.sh" "DEVMAN"
load_manager "gitman" "$DOTFILES_BASH_PATH/functions/gitman.sh" "GITMAN"
load_manager "helpman" "$DOTFILES_BASH_PATH/functions/helpman.sh" "HELPMAN"
load_manager "manman" "$DOTFILES_BASH_PATH/functions/manman.sh" "MANMAN"
load_manager "configman" "$DOTFILES_BASH_PATH/functions/configman.sh" "CONFIGMAN"
load_manager "installman" "$DOTFILES_BASH_PATH/functions/installman.sh" "INSTALLMAN"
load_manager "moduleman" "$DOTFILES_BASH_PATH/functions/moduleman.sh" "MODULEMAN"
load_manager "fileman" "$DOTFILES_BASH_PATH/functions/fileman.sh" "FILEMAN"
load_manager "virtman" "$DOTFILES_BASH_PATH/functions/virtman.sh" "VIRTMAN"
load_manager "sshman" "$DOTFILES_BASH_PATH/functions/sshman.sh" "SSHMAN"
load_manager "testzshman" "$DOTFILES_BASH_PATH/functions/testzshman.sh" "TESTZSHMAN"
load_manager "testman" "$DOTFILES_BASH_PATH/functions/testman.sh" "TESTMAN"

# =============================================================================
# Ã‰TAPE 2.5 : CONFIGURATION HISTORIQUE (AVANT ENV)
# =============================================================================
# Charger la configuration d'historique partagÃ©
[ -f "$DOTFILES_BASH_PATH/history.sh" ] && source "$DOTFILES_BASH_PATH/history.sh" 2>/dev/null || true

# =============================================================================
# Ã‰TAPE 3 : CHARGEMENT DES VARIABLES D'ENVIRONNEMENT
# =============================================================================
if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
fi

# =============================================================================
# Ã‰TAPE 4 : CHARGEMENT DES ALIASES
# =============================================================================
if [ -f "$ALIASES_FILES" ]; then
    source "$ALIASES_FILES" 2>/dev/null || true
fi

# =============================================================================
# Ã‰TAPE 4.5 : CHARGEMENT DES FONCTIONS UTILITAIRES
# =============================================================================
# Charger ipinfo (informations IP et rÃ©seau)
[ -f "$DOTFILES_BASH_PATH/functions/ipinfo.sh" ] && source "$DOTFILES_BASH_PATH/functions/ipinfo.sh" 2>/dev/null || true
# Charger network_scanner (scanner rÃ©seau en temps rÃ©el)
[ -f "$DOTFILES_BASH_PATH/functions/network_scanner.sh" ] && source "$DOTFILES_BASH_PATH/functions/network_scanner.sh" 2>/dev/null || true
# Charger whatismyip (IP publique)
[ -f "$DOTFILES_BASH_PATH/functions/whatismyip.sh" ] && source "$DOTFILES_BASH_PATH/functions/whatismyip.sh" 2>/dev/null || true

# =============================================================================
# Ã‰TAPE 5 : CHARGEMENT DES UTILITAIRES
# =============================================================================
if [ -d "$DOTFILES_BASH_PATH/utils" ]; then
    for util_file in "$DOTFILES_BASH_PATH/utils"/*.sh; do
        [ -f "$util_file" ] && source "$util_file" 2>/dev/null || true
    done
fi

# Message d'initialisation (optionnel)
# echo "ğŸš Configuration Bash chargÃ©e - Managers disponibles"

