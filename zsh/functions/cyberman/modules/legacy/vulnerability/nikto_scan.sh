# Nouvelle fonction pour effectuer un scan de vulnÃ©rabilitÃ©s avec Nikto
# DESC: Effectue un scan de sÃ©curitÃ© web avec Nikto pour identifier les problÃ¨mes de configuration et vulnÃ©rabilitÃ©s. Utilise les cibles configurÃ©es si aucune n'est fournie.
# USAGE: nikto_scan [url] [options]
# EXAMPLE: nikto_scan https://example.com
# EXAMPLE: nikto_scan  # Utilise les cibles configurÃ©es
function nikto_scan() {
    # VÃ©rifier et installer nikto si nÃ©cessaire
    UTILS_DIR="$HOME/dotfiles/zsh/functions/utils"
    if [ -f "$UTILS_DIR/ensure_tool.sh" ]; then
        source "$UTILS_DIR/ensure_tool.sh"
        ensure_tool nikto || return 1
    fi
    
    # Charger le gestionnaire de cibles
    local CYBER_DIR="$HOME/dotfiles/zsh/functions/cyber"
    if [ -f "$CYBER_DIR/target_manager.sh" ]; then
        source "$CYBER_DIR/target_manager.sh"
    fi
    
    local target=""
    local nikto_args=""
    
    # Parser les arguments
    if [ $# -gt 0 ]; then
        target="$1"
        shift
        nikto_args="$@"
    fi
    
    # Si aucune cible fournie, utiliser les cibles configurÃ©es
    if [ -z "$target" ]; then
        if has_targets; then
            echo "ğŸ¯ Utilisation des cibles configurÃ©es:"
            show_targets
            echo ""
            printf "Utiliser toutes les cibles? (O/n): "
            read -r use_all
            if [ "$use_all" != "n" ] && [ "$use_all" != "N" ]; then
                # Utiliser toutes les cibles
                for t in "${CYBER_TARGETS[@]}"; do
                    echo ""
                    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
                    echo "ğŸ¯ Scan Nikto: $t"
                    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
                    nikto -h "$t" $nikto_args
                done
                return 0
            else
                target=$(prompt_target "ğŸ¯ Entrez l'URL cible: ")
                if [ -z "$target" ]; then
                    return 1
                fi
            fi
        else
            target=$(prompt_target "ğŸ¯ Entrez l'URL cible: ")
            if [ -z "$target" ]; then
                return 1
            fi
        fi
    fi
    
    nikto -h "$target" $nikto_args
}
