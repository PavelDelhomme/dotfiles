# ~/dotfiles/zsh/zshrc_custom - VERSION CORRIG√âE

# Restaurer le PATH original si n√©cessaire
if [ -n "$PATH_ORIGINAL" ]; then
	export PATH=$PATH_ORIGINAL
fi

DOTFILES_PATH="$HOME/dotfiles/"
DOTFILES_ZSH_PATH="$DOTFILES_PATH/zsh/"
ENV_FILE="$DOTFILES_ZSH_PATH/env.sh"
ALIASES_FILES="$DOTFILES_ZSH_PATH/aliases.zsh"
FUNCTIONS_DIR="$DOTFILES_ZSH_PATH/functions/"

# === Chargement des fonctions ===
if [ -d "$FUNCTIONS_DIR" ]; then
    # CORRECTION: Charger aussi les fichiers .zsh
    for func_file in "$FUNCTIONS_DIR"/**/*.sh "$FUNCTIONS_DIR"/**/*.zsh; do
        if [ -f "$func_file" ]; then
            source "$func_file" && echo "‚úîÔ∏è Charg√© : $func_file" || echo "‚ùå Erreur de chargement : $func_file"
        fi
    done
else
    echo "‚ö†Ô∏è R√©pertoire de fonctions introuvable : $FUNCTIONS_DIR"
fi

backup_dotfiles() {
	echo "üìÅ Sauvegarde manuelle des dotfiles..."
	~/auto_backup_dotfiles.sh
	echo "‚úÖ Sauvegarde termin√©e."
}

# === Environments ===
if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
else
    echo "‚ö†Ô∏è Fichier $ENV_FILE introuvable."
fi

# === Chargement des alias ===
if [ -f "$ALIASES_FILES" ]; then
    source "$ALIASES_FILES"
else
    echo "‚ö†Ô∏è Fichier $ALIASES_FILES introuvable."
fi

whoami-git() {
  echo "user.name = $(git config --global user.name)"
  echo "user.email = $(git config --global user.email)"
  echo "R√©pertoire courant : $PWD"
}

switch-git-identity() {
  local arg="$1"
  local path="$PWD"

  # Si argument fourni
  if [[ "$arg" == "piter" ]]; then
    git config --global user.name "Paul Piter"
    git config --global user.email "paul@piter.at"
    echo "Profil global Git: pro (Paul Piter)"
    whoami-git
    return
  elif [[ "$arg" == "perso" ]]; then
    git config --global user.name "Paul Delhomme"
    git config --global user.email "36136537+PavelDelhomme@users.noreply.github.com"
    echo "Profil global Git: perso (Paul Delhomme)"
    whoami-git
    return
  fi

  # Si aucun argument, d√©termine seul le contexte Piter
  if [[ "$path" =~ ^/home/pactivisme/Documents/Travail/.*[Pp][Ii][Tt][Ee][Rr].* ]]; then
	  whoami-git
	  git config --global user.name "Paul Piter"
	  git config --global user.email "paul@piter.at"
	  echo "Profil automatiquement bascul√© sur Piter (dossier contenant 'Piter')"
  else
	  whoami-git
	  git config --global user.name "Paul Delhomme"
	  git config --global user.email "36136537+PavelDelhomme@users.noreply.github.com"
	  echo "Profil automatiquement bascul√© sur Delhomme (dossier sans 'Piter')"
  fi
  whoami-git
}

neofetch

# =============================================================================
# GESTIONNAIRES UNIFI√âS (*MAN) - CORRECTION DES CHEMINS
# =============================================================================
# NETMAN - Network Manager  
[ -f "$DOTFILES_ZSH_PATH/functions/netman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/netman.zsh"

# PATHMAN - Path Manager
[ -f "$DOTFILES_ZSH_PATH/functions/pathman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/pathman.zsh"

# ALIAMAN - Alias Manager  
[ -f "$DOTFILES_ZSH_PATH/functions/aliaman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/aliaman.zsh"

# MISCMAN - Misc Manager
[ -f "$DOTFILES_ZSH_PATH/functions/miscman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/miscman.zsh"

# SEARCHMAN - Search Manager
[ -f "$DOTFILES_ZSH_PATH/functions/searchman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/searchman.zsh"

# Messages de confirmation du chargement des gestionnaires
echo "üöÄ Gestionnaires charg√©s: NETMAN, PATHMAN, ALIAMAN, MISCMAN, SEARCHMAN"
