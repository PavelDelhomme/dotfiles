# ~/dotfiles/zsh/zshrc_custom - VERSION CORRIG√âE

# Restaurer le PATH original si n√©cessaire
if [ -n "$PATH_ORIGINAL" ]; then
	export PATH=$PATH_ORIGINAL
fi

DOTFILES_PATH="$HOME/dotfiles/"
DOTFILES_ZSH_PATH="$DOTFILES_PATH/zsh/"
ENV_FILE="$DOTFILES_ZSH_PATH/env.sh"
ALIASES_FILES="$DOTFILES_ZSH_PATH/aliases.zsh"
FUNCTIONS_DIR="$DOTFILES_ZSH_PATH/functions/"


# =============================================================================
# CHARGEMENT DES GESTIONNAIRES (*MAN) EN PREMIER
# =============================================================================
echo "üöÄ Chargement des gestionnaires..."

[ -f "$DOTFILES_ZSH_PATH/functions/pathman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/pathman.zsh" && echo "‚úîÔ∏è PATHMAN charg√©"
[ -f "$DOTFILES_ZSH_PATH/functions/netman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/netman.zsh" && echo "‚úîÔ∏è NETMAN charg√©"
[ -f "$DOTFILES_ZSH_PATH/functions/aliaman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/aliaman.zsh" && echo "‚úîÔ∏è ALIAMAN charg√©"
[ -f "$DOTFILES_ZSH_PATH/functions/miscman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/miscman.zsh" && echo "‚úîÔ∏è MISCMAN charg√©"
[ -f "$DOTFILES_ZSH_PATH/functions/searchman.zsh" ] && source "$DOTFILES_ZSH_PATH/functions/searchman.zsh" && echo "‚úîÔ∏è SEARCHMAN charg√©"


# =============================================================================
# CHARGEMENT DES FONCTIONS INDIVIDUELLES
# =============================================================================
if [ -d "$FUNCTIONS_DIR" ]; then
    for func_file in "$FUNCTIONS_DIR"/**/*.sh "$FUNCTIONS_DIR"/**/*.zsh; do
        # Ignore les gestionnaires d√©j√† charg√©s
        if [[ "$func_file" != *"man.zsh" ]] && [ -f "$func_file" ]; then
            source "$func_file" 2>/dev/null && echo "  ‚úîÔ∏è $func_file" || echo "  ‚ùå Erreur: $func_file"
        fi
    done
else
    echo "‚ö†Ô∏è R√©pertoire de fonctions introuvable : $FUNCTIONS_DIR"
fi

# =============================================================================
# FONCTION BACKUP DOTFILES
# =============================================================================
backup_dotfiles() {
    echo "üìÅ Sauvegarde manuelle des dotfiles..."
    ~/auto_backup_dotfiles.sh
    echo "‚úÖ Sauvegarde termin√©e."
}

# =============================================================================
# ENVIRONMENTS
# =============================================================================
if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
else
    echo "‚ö†Ô∏è Fichier $ENV_FILE introuvable."
fi

# =============================================================================
# ALIASES
# =============================================================================
if [ -f "$ALIASES_FILES" ]; then
    source "$ALIASES_FILES"
else
    echo "‚ö†Ô∏è Fichier $ALIASES_FILES introuvable."
fi

# =============================================================================
# FONCTIONS GIT
# =============================================================================
whoami-git() {
    echo "user.name = $(git config --global user.name)"
    echo "user.email = $(git config --global user.email)"
    echo "R√©pertoire courant : $PWD"
}

switch-git-identity() {
    local arg="$1"
    local path="$PWD"

    if [[ "$arg" == "piter" ]]; then
        git config --global user.name "Paul Piter"
        git config --global user.email "paul@piter.at"
        echo "Profil global Git: pro (Paul Piter)"
        whoami-git
        return
    elif [[ "$arg" == "perso" ]]; then
        git config --global user.name "Paul Delhomme"
        git config --global user.email "36136537+PavelDelhomme@users.noreply.github.com"
        echo "Profil global Git: perso (Paul Delhomme)"
        whoami-git
        return
    fi

    if [[ "$path" =~ ^/home/pactivisme/Documents/Travail/.*[Pp][Ii][Tt][Ee][Rr].* ]]; then
        git config --global user.name "Paul Piter"
        git config --global user.email "paul@piter.at"
        echo "Profil automatiquement bascul√© sur Piter"
    else
        git config --global user.name "Paul Delhomme"
        git config --global user.email "36136537+PavelDelhomme@users.noreply.github.com"
        echo "Profil automatiquement bascul√© sur Delhomme"
    fi
    whoami-git
}

neofetch
echo "üéâ Configuration ZSH personnalis√©e charg√©e avec succ√®s"

